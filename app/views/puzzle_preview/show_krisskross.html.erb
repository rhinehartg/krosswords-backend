<!DOCTYPE html>
<html>
<head>
  <title>KrissKross Puzzle Preview - Puzzle #<%= @puzzle.id %></title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background-color: #f5f5f5;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .header {
      text-align: center;
      margin-bottom: 30px;
      border-bottom: 2px solid #ff6b35;
      padding-bottom: 20px;
    }
    
    .puzzle-title {
      font-size: 2.5em;
      color: #333;
      margin: 0;
    }
    
    .puzzle-description {
      font-size: 1.2em;
      color: #666;
      margin: 10px 0;
    }
    
    .puzzle-meta {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin: 15px 0;
    }
    
    .meta-item {
      background: #e9ecef;
      padding: 8px 16px;
      border-radius: 20px;
      font-weight: bold;
    }
    
    .content {
      display: flex;
      gap: 30px;
      flex-wrap: wrap;
    }
    
    .crossword-grid {
      flex: 1;
      min-width: 400px;
    }
    
    .words-panel {
      flex: 1;
      min-width: 300px;
    }
    
    .grid {
      display: inline-block;
      border: 2px solid #333;
      margin: 20px auto;
    }
    
    .grid-row {
      display: flex;
    }
    
    .grid-cell {
      width: 30px;
      height: 30px;
      border: 1px solid #ccc;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 14px;
      background: white;
    }
    
    .grid-cell.black {
      background: #333;
    }
    
    .grid-cell.numbered {
      position: relative;
    }
    
    .cell-number {
      position: absolute;
      top: 2px;
      left: 2px;
      font-size: 10px;
      font-weight: bold;
      color: #333;
    }
    
    .words-section {
      margin-bottom: 30px;
    }
    
    .words-title {
      font-size: 1.5em;
      font-weight: bold;
      margin-bottom: 15px;
      color: #333;
      border-bottom: 1px solid #ddd;
      padding-bottom: 5px;
    }
    
    .word-item {
      margin-bottom: 10px;
      padding: 8px;
      background: #f8f9fa;
      border-left: 4px solid #ff6b35;
      border-radius: 4px;
      font-weight: bold;
      font-size: 16px;
    }
    
    .back-button {
      display: inline-block;
      background: #ff6b35;
      color: white;
      padding: 10px 20px;
      text-decoration: none;
      border-radius: 5px;
      margin-bottom: 20px;
    }
    
    .back-button:hover {
      background: #e55a2b;
    }
    
    @media (max-width: 768px) {
      .content {
        flex-direction: column;
      }
      
      .grid-cell {
        width: 25px;
        height: 25px;
        font-size: 12px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <a href="<%= admin_puzzle_path(@puzzle) %>" class="back-button">‚Üê Back to Puzzle</a>
    
    <div class="header">
      <h1 class="puzzle-title">KrissKross - <%= @puzzle.challenge_date&.strftime('%B %d, %Y') || 'No date' %></h1>
      <p class="puzzle-description">
        <%= @puzzle.clue || @puzzle.puzzle_data&.dig('clue') || 'No theme' %>
      </p>
      <div class="puzzle-meta">
        <span class="meta-item">
          <%= @puzzle.puzzle_data['words']&.count || @puzzle.puzzle_data[:words]&.count || 0 %> Words
        </span>
      </div>
    </div>

    <div class="content">
      <div class="crossword-grid">
        <div class="grid">
          <% @crossword_layout[:table].each_with_index do |row, row_index| %>
            <div class="grid-row">
              <% row.each_with_index do |cell, col_index| %>
                <% 
                  is_black = cell == '#' || cell.blank?
                  word_at_position = @crossword_layout[:result].find do |word|
                    next if word[:startx].nil? || word[:starty].nil?
                    word_start_row = word[:starty] - 1
                    word_start_col = word[:startx] - 1
                    
                    if word[:orientation] == 'across'
                      word_start_row == row_index && 
                      col_index >= word_start_col && 
                      col_index < word_start_col + word[:answer].length
                    else
                      word_start_col == col_index && 
                      row_index >= word_start_row && 
                      row_index < word_start_row + word[:answer].length
                    end
                  end
                  
                  is_numbered = word_at_position && 
                    word_at_position[:startx] && 
                    word_at_position[:starty] &&
                    (word_at_position[:startx] - 1) == col_index && 
                    (word_at_position[:starty] - 1) == row_index
                %>
                <div class="grid-cell <%= 'black' if is_black %> <%= 'numbered' if is_numbered %>">
                  <% if is_numbered %>
                    <span class="cell-number"><%= word_at_position[:position] %></span>
                  <% end %>
                  <%= cell unless is_black %>
                </div>
              <% end %>
            </div>
          <% end %>
        </div>
      </div>

      <div class="words-panel">
        <div class="words-section">
          <h3 class="words-title">Words to Place</h3>
          <% words = @puzzle.puzzle_data['words'] || @puzzle.puzzle_data[:words] || [] %>
          <% words.each_with_index do |word, index| %>
            <div class="word-item">
              <%= index + 1 %>. <%= word %>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</body>
</html>

